name: Frontend Notification

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Notification
        run: |
          # Escape special characters for JSON
          COMMIT_MESSAGE=$(echo '${{ github.event.head_commit.message }}' | sed 's/"/\\"/g' | sed "s/'/\\'/g" | tr -d '\n\r')
          AUTHOR=$(echo '${{ github.actor }}' | sed 's/"/\\"/g')
          REPOSITORY=$(echo '${{ github.repository }}' | sed 's/"/\\"/g')
          BRANCH=$(echo '${{ github.ref_name }}' | sed 's/"/\\"/g')

          # Prepare message thread ID if specified
          THREAD_ID_PARAM=""
          if [ -n "${{ secrets.TELEGRAM_THREAD_ID }}" ]; then
            THREAD_ID_PARAM=", \"message_thread_id\": \"${{ secrets.TELEGRAM_THREAD_ID }}\""
          fi

          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d "{
              \"chat_id\": \"${{ secrets.TELEGRAM_CHAT_ID }}\"$THREAD_ID_PARAM,
              \"text\": \"ðŸš€ *Frontend Push Detected!*\\nRepository: $REPOSITORY\\nBranch: $BRANCH\\nCommit: $COMMIT_MESSAGE\\nAuthor: $AUTHOR\",
              \"parse_mode\": \"Markdown\",
              \"disable_web_page_preview\": true,
              \"reply_markup\": {
                \"inline_keyboard\": [
                  [
                    {
                      \"text\": \"ðŸ“‹ View Changes\",
                      \"url\": \"${{ github.event.compare }}\"
                    },
                    {
                      \"text\": \"ðŸ“‚ Repository\",
                      \"url\": \"${{ github.event.repository.html_url }}\"
                    }
                  ]
                ]
              }
            }"
