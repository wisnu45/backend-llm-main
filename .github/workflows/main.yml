name: Notif Push Frontend

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Message
        run: |
          COMMIT_MESSAGE=$(echo '${{ github.event.head_commit.message }}' | sed 's/"/\\"/g' | sed "s/'/\\'/g" | tr -d '\n\r')
          AUTHOR=$(echo '${{ github.actor }}' | sed 's/"/\\"/g')
          REPOSITORY=$(echo '${{ github.repository }}' | sed 's/"/\\"/g')
          BRANCH=$(echo '${{ github.ref_name }}' | sed 's/"/\\"/g')

          THREAD_ID_PARAM=""
          if [ -n "${{ secrets.TELEGRAM_THREAD_ID }}" ]; then
            THREAD_ID_PARAM=", \"message_thread_id\": \"${{ secrets.TELEGRAM_THREAD_ID }}\""
          fi

          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d "{\n  \"chat_id\": \"${{ secrets.TELEGRAM_CHAT_ID }}\"$THREAD_ID_PARAM,\n  \"text\": \"*Frontend Push Detected!*\\nRepository: $REPOSITORY\\nBranch: $BRANCH\\nCommit: $COMMIT_MESSAGE\\nAuthor: $AUTHOR\",\n  \"parse_mode\": \"Markdown\",\n  \"disable_web_page_preview\": true,\n  \"reply_markup\": {\n    \"inline_keyboard\": [\n      [\n        {\n          \"text\": \"ðŸ“‹ View Changes\",\n          \"url\": \"${{ github.event.compare }}\"\n        },\n        {\n          \"text\": \"ðŸ“‚ Repository\",\n          \"url\": \"${{ github.event.repository.html_url }}\"\n        }\n      ]\n    ]\n  }\n}"
