tags:
  - Chats
summary: Riwayat Chat dengan Verifikasi Dokumen
description: |
  Mendapatkan riwayat percakapan berdasarkan chat_id dengan verifikasi ketersediaan dokumen yang direferensikan.
  
  **Fitur Verifikasi Dokumen:**
  - Memeriksa ketersediaan dokumen di database dan file system
  - Menangani berbagai field name dalam metadata (document_name, original_filename, stored_filename)
  - Memberikan status dokumen yang akurat (available, file_missing, db_missing, missing, error)
  - Mendukung path Docker yang berbeda (production /app, development /combiphar-be)
security:
  - bearerAuth: []
parameters:
  - in: path
    name: chat_id
    schema:
      type: string
      format: uuid
    required: true
    description: Session ID
responses:
  200:
    description: Berhasil mengambil riwayat percakapan
    content:
      application/json:
        schema:
          type: object
          properties:
            message:
              type: string
            data:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  chat_id:
                    type: string
                    format: uuid
                  question:
                    type: string
                  answer:
                    type: string
                  attachments:
                    type: array
                    items:
                      type: object
                      properties:
                        mimetype:
                          type: string
                          description: "Tipe MIME dari attachment."
                          example: "image/png"
                        ext:
                          type: string
                          description: "Ekstensi file dari attachment."
                          example: "png"
                        url:
                          type: string
                          description: "URL untuk mengunduh atau melihat attachment."
                          example: "https://api.example.com/storage/123e4567-e89b-12d3-a456-426614174000"
                  created_at:
                    type: string
                    format: date-time
                  file_links:
                    type: array
                    items:
                      type: object
                      properties:
                        filename:
                          type: string
                        download_url:
                          type: string
                          nullable: true
                        score:
                          type: number
                        document_status:
                          type: string
                          enum: [available, file_missing, db_missing, missing, error]
                        exists_in_db:
                          type: boolean
                        exists_in_file:
                          type: boolean
                        status_message:
                          type: string
                          description: Pesan status untuk dokumen yang tidak tersedia
        examples:
          success_with_available_docs:
            value:
              message: "Berhasil mengambil riwayat percakapan"
              data:
                - id: "f1e2d3c4-b5a6-7d8c-9e0f-123456789abc"
                  chat_id: "123e4567-e89b-12d3-a456-426614174000"
                  question: "Apa itu benefit?"
                  answer: "Benefit adalah ..."
                  file_links:
                    - filename: "policy_document.pdf"
                      download_url: "http://api.example.com/storage/policy_document.pdf"
                      score: 0.95
                      document_status: "available"
                      exists_in_db: true
                      exists_in_file: true
                  created_at: "2024-01-01T00:00:00Z"
                  attachments:
                    - mimetype: "image/png"
                      ext: "png"
                      url: "https://api.example.com/storage/123e4567-e89b-12d3-a456-426614174000"
          success_with_missing_docs:
            value:
              message: "Berhasil mengambil riwayat percakapan"
              data:
                - id: "a1b2c3d4-e5f6-7a8b-9c0d-23456789abcd"
                  chat_id: "123e4567-e89b-12d3-a456-426614174000"
                  question: "Tentang prosedur klaim?"
                  answer: "Prosedur klaim adalah ..."
                  file_links:
                    - filename: "deleted_document.pdf"
                      download_url: null
                      score: 0.87
                      document_status: "missing"
                      exists_in_db: false
                      exists_in_file: false
                      status_message: "Dokumen tidak tersedia (terhapus dari database dan file system)"
                  created_at: "2024-01-01T00:00:00Z"
                  attachments:
                    - mimetype: "image/png"
                      ext: "png"
                      url: "https://api.example.com/storage/123e4567-e89b-12d3-a456-426614174000"
  400:
    description: Session ID tidak valid
    content:
      application/json:
        schema:
          type: object
          properties:
            message:
              type: string
        examples:
          error:
            value:
              message: "Session ID harus berupa UUID yang valid"
