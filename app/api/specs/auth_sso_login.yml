tags:
  - Authentication
summary: Login SSO dari Portal
description: |
  Login SSO menggunakan token dari Portal Combiphar. Mengembalikan access token dan refresh token.
  - Token divalidasi ke Portal Combiphar
  - User otomatis terdaftar jika belum ada
  - Access token adalah JWT untuk akses API (15 menit)
  - Refresh token dikirim sebagai HttpOnly Secure Cookie (durasi sesuai JWT_REFRESH_TOKEN_EXPIRE_DAYS)
  - Cookie settings: HttpOnly=true, Secure=true (production), SameSite=None/Lax (tergantung environment)
requestBody:
  required: true
  content:
    application/json:
      schema:
        type: object
        required:
          - token
        properties:
          token:
            type: string
            description: Token SSO dari Portal Combiphar
            example: "encrypted_portal_token_here"
responses:
  200:
    description: Login SSO berhasil
    headers:
      Set-Cookie:
        description: HttpOnly Secure Cookie berisi refresh token
        schema:
          type: string
          example: "refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; HttpOnly; Secure; SameSite=None; Max-Age=86400"
    content:
      application/json:
        schema:
          type: object
          properties:
            message:
              type: string
              example: "Berhasil login"
            data:
              type: object
              properties:
                access_token:
                  type: string
                  description: JWT access token untuk akses API
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                userdata:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                      example: "123e4567-e89b-12d3-a456-426614174000"
                    name:
                      type: string
                      example: "Employee Name"
                    username:
                      type: string
                      example: "employee.id"
                    role:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          example: "456e7890-e12b-34c5-d678-901234567890"
                        name:
                          type: string
                          example: "user"
                    is_portal:
                      type: boolean
                      example: true
                    created_at:
                      type: string
                      format: date-time
                      nullable: true
                      example: "2024-01-01T00:00:00Z"
                    updated_at:
                      type: string
                      format: date-time
                      nullable: true
                      example: "2024-01-01T00:00:00Z"
  400:
    description: Token tidak diberikan
    content:
      application/json:
        schema:
          type: object
          properties:
            message:
              type: string
              example: "SSO token is required"
  401:
    description: Token tidak valid atau expired
    content:
      application/json:
        schema:
          type: object
          properties:
            message:
              type: string
              example: "Token validation failed: Invalid token"
  404:
    description: User tidak ditemukan atau gagal registrasi otomatis
    content:
      application/json:
        schema:
          type: object
          properties:
            message:
              type: string
              example: "User not registered in the system and failed to auto-register. Please contact administrator."
  500:
    description: Server error atau SSO login gagal
    content:
      application/json:
        schema:
          type: object
          properties:
            message:
              type: string
              example: "SSO login failed due to internal error"
